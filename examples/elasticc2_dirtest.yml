# Dev version for developic elasticc2 pipeline


name: elasticc2-dev
parameters:
- name: parsnip_classifier_url
  value: https://box.hu-berlin.de/f/9b2b669d82c74f328cef/?dl=1
- name: parsnip_model_url
  value: https://box.hu-berlin.de/f/ad6093bac5fd43ec80ee/?dl=1
- name: parsnip_noknclassifier_url
  value: https://box.hu-berlin.de/f/ee8aa4c5fd84420bacce/?dl=1
- name: parsnip_noknmodel_url
  value: https://box.hu-berlin.de/f/9212c49069674dd6bef5/?dl=1
- name: model_stars_ulens
  value: https://box.hu-berlin.de/f/181b349a8dc54754b5a8/?dl=1
- name: model_stars_ulens_mdwarf_nova
  value: https://box.hu-berlin.de/f/35dee5238131438687e8/?dl=1
- name: model_sn_vs_long
  value: https://box.hu-berlin.de/f/331223e24ff44ea88747/?dl=1
- name: model_nova_vs_mdwarf
  value: https://box.hu-berlin.de/f/e761392803af444e9da4/?dl=1
- name: model_varstar_ulens_vs_mdwarf_nova
  value: https://box.hu-berlin.de/f/1a577354f6614f7c92df/?dl=1
- name: model_kn_vs_parsnip
  value: https://box.hu-berlin.de/f/160f9cf5c5eb4f218f89/?dl=1
- name: model_agn_vs_kn_parsnip
  value: https://box.hu-berlin.de/f/91b01311453f4ed59aca/?dl=1
- name: model_galactic_vs_non_galactic
  value: https://box.hu-berlin.de/f/49db4489233240e49ac5/?dl=1
- name: alertsample
  value: https://portal.nersc.gov/cfs/lsst/DESC_TD_PUBLIC/ELASTICC/5000alerts.tar.gz

mongo:
  prefix: Elasticc2
  reset: true

channel:
- name: elasticc
  access: []
  policy: []
  version: 1

task:

- title: ingest

  unit: AlertConsumer
  config:
    iter_max: 100000000
    compiler_opts: LSSTCompilerOptions

    supplier:
      unit: LSSTAlertSupplier
      config:
        deserialize: null
        loader:
          config:
            folder: 5000alertsdir/NITE60562
            extension: "*avro.gz"
          unit: ElasticcDirAlertLoader

    shaper: {unit: LSSTDataPointShaper}

    directives:
    - channel: elasticc

      filter:
        unit: ReallySimpleLSSTFilter
        on_stock_match: bypass
        config:
          min_ndet: 0
          min_tspan: 0
          max_tspan: 10000

      ingest:
          mux:
            unit: LSSTMongoMuxer
            combine:
            - unit: LSSTT1Combiner
              state_t2:
              - config:
                  paths_xgbbinary:
                    gal_vs_nongal: model_galactic_vs_non_galactic
                    agn_vs_knsnlong: model_agn_vs_kn_parsnip
                    kn_vs_snlong: model_kn_vs_parsnip
                    sn_vs_long: model_sn_vs_long
                  paths_xgbmulti:
                    stars_ulens:
                      path: model_stars_ulens
                      classes: [2322, 2324, 2325, 2323, 2235]
                    stars_ulens_mdwarf_nova:
                      path: model_stars_ulens_mdwarf_nova
                      classes: [2322, 2324, 2325, 2233, 2234, 2323, 2235]
                    all:
                      path: model_all
                      classes: [2332, 2245, 2322, 2324, 2325, 2244, 2232, 2233, 2234, 2246, 2323, 2242, 2226, 2222, 2225, 2223, 2224, 2243, 2235]
                  paths_parsnip:
                    knsnlong:
                      model: elasticc2_run20_KNSNLONG.h5
                      classifier: elasticc2_run20_KNSNLONG_pred_aug10_classifier.pkl
                    snlong:
                      model: elasticc2_run20_SNLONG.h5
                      classifier: elasticc2_run20_SNLONG_pred_aug10_classifier.pkl
                  tabulator:
                  - unit: LSSTT2Tabulator
                    config:
                      zp: 31.4
                unit: T2Elasticc2Classifier
  inputs:
    artifacts:
      - name: alertsample
        path: 5000alertsdir
        http:
          url: "{{ job.parameters.alertsample }}"
      - name: model_galactic_vs_non_galactic
        path: model_galactic_vs_non_galactic
        http:
          url: "{{ job.parameters.model_galactic_vs_non_galactic }}"
      - name: model_agn_vs_kn_parsnip
        path: model_agn_vs_kn_parsnip
        http:
          url: "{{ job.parameters.model_agn_vs_kn_parsnip }}"
      - name: model_kn_vs_parsnip
        path: model_kn_vs_parsnip
        http:
          url: "{{ job.parameters.model_kn_vs_parsnip }}"
      - name: model_varstar_ulens_vs_mdwarf_nova
        path: model_varstar_ulens_vs_mdwarf_nova
        http:
          url: "{{ job.parameters.model_varstar_ulens_vs_mdwarf_nova }}"
      - name: model_nova_vs_mdwarf
        path: model_nova_vs_mdwarf
        http:
          url: "{{ job.parameters.model_nova_vs_mdwarf }}"
      - name: model_sn_vs_long
        path: model_sn_vs_long
        http:
          url: "{{ job.parameters.model_sn_vs_long }}"
      - name: model_stars_ulens
        path: model_stars_ulens
        http:
          url: "{{ job.parameters.model_stars_ulens }}"
      - name: model_stars_ulens_mdwarf_nova
        path: model_stars_ulens_mdwarf_nova
        http:
          url: "{{ job.parameters.model_stars_ulens_mdwarf_nova }}"
      - name: elasticc2_run20_KNSNLONG
        path: elasticc2_run20_KNSNLONG.h5
        http:
          url: "{{ job.parameters.parsnip_model_url }}"
      - name: elasticc2_run20_KNSNLONG_pred_aug10_classifier
        path: elasticc2_run20_KNSNLONG_pred_aug10_classifier.pkl
        http:
          url: "{{ job.parameters.parsnip_classifier_url }}"
      - name: elasticc2_run20_SNLONG
        path: elasticc2_run20_SNLONG.h5
        http:
          url: "{{ job.parameters.parsnip_noknmodel_url }}"
      - name: elasticc2_run20_SNLONG_pred_aug10_classifier
        path: elasticc2_run20_SNLONG_pred_aug10_classifier.pkl
        http:
          url: "{{ job.parameters.parsnip_noknclassifier_url }}"



- title: t2_row3
  multiplier: 1
  unit: T2Worker
  config:
    doc_limit: 50000
    max_try: 10
