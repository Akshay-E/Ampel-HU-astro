name: cone_stream
parameters:
- name: channelname
  value: cone_stream

mongo:
  prefix: ConeStreamTokenGenerator
  reset: true

channel:
- name: cone_stream
  access: [ZTF, ZTF_PUB, ZTF_PRIV]
  policy: []

task:


- title: token
  unit: T3Processor
  config:
    raise_exc: true
    execute:
      - unit: T3PlainUnitExecutor
        config:
          target:
            unit: T3ZTFArchiveTokenGeneratorConeStream
            config:              
              debug: true
              resource_name: ztf_stream_token
              cone:
                ra: 10.0
                dec: 30.0
                radius: 0.01

- title: NearbyInfantReact
  unit: AlertConsumer
  config:
    iter_max: 100000
    supplier:
      unit: ZiAlertSupplier
      config:
        deserialize: null
        loader:
          unit: ZTFArchiveAlertLoader
          config:
            resource_name: ztf_stream_token
              
    shaper: ZiDataPointShaper
    directives:
    - channel: "{{ job.parameters.channelname }}"
      filter:
        config:
          gaia_excessnoise_sig_max: 999
          gaia_plx_signif: 3
          gaia_pm_signif: 3
          gaia_rs: 20
          gaia_veto_gmag_max: 20
          gaia_veto_gmag_min: 9
          min_ndet: 1
          min_tspan: -99
          max_tspan: 1
          min_archive_tspan: -99
          max_archive_tspan: 100
          min_drb: 0.995
          min_gal_lat: 14
          min_rb: 0.3
          min_sso_dist: 20
          ps1_confusion_rad: 0         # Turns off PS1 confusion check. Maybe redundnant with drb?
          ps1_confusion_sg_tol: 0.1
          ps1_sgveto_rad: 1
          ps1_sgveto_th: 0.8
          max_fwhm: 5.5
          max_elong: 2
          max_magdiff: 1
          max_nbad: 2
        on_stock_match: bypass
        unit: DecentFilter
